syntax = "proto3";

package file;

option go_package = "./pb";

message InitUploadReq {
  string hash = 1;
  string fileName = 2;
  string fileType = 3;
  int64 fileSize = 4;
  int64 uploader = 5;
}

message InitUploadResp {
  string uploadId = 1;
  string bucket = 2;
}

message UploadPartReq {
  string uploadId = 1;
  int32 partNumber = 2;
  bytes chunkData = 3;  // 分片流中的一部分数据
}

message UploadPartResp {
  string etag = 1;      // MinIO 返回的分片 ETag
}

message CompleteUploadReq {
  string uploadId = 1;
  string hash = 2;
}

message CompleteUploadResp {
  int64 fileId = 1;
  string fileUrl = 2;
}

// ========== 服务定义 ==========
service File {
  rpc InitUpload(InitUploadReq) returns (InitUploadResp);

  // 流式上传分片
  rpc UploadPart(stream UploadPartReq) returns (UploadPartResp);

  rpc CompleteUpload(CompleteUploadReq) returns (CompleteUploadResp);
}